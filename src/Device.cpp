/*
 * Device.cpp
 *
 *  Created on: Aug 3, 2016
 *      Author: root
 */

#include "Device.h"

#include <iostream>

static bool operator < (const ndpi_protocol &_lhs, const ndpi_protocol &_rhs) {
	return _lhs.master_protocol < _rhs.master_protocol;
}

Device::Device() {
	// TODO Auto-generated constructor stub

}

Device::Device(const unsigned long &_ip)
:__ip(_ip) {}

Device::Device(const Device &_origin)
:__ip(_origin.__ip), __protocol_table(_origin.__protocol_table), __os(_origin.__os) {}

Device::~Device() {
	// TODO Auto-generated destructor stub
}

void Device::set_os(const std::string _os) {
	__os = _os;
}

void Device::add_protocol(ndpi_protocol &_proto) {
	std::map<const ndpi_protocol, size_t>::iterator p_iter;

	p_iter = __protocol_table.find(_proto);

	if (p_iter == __protocol_table.end()) {
		__protocol_table.insert(std::pair<ndpi_protocol, size_t>(_proto, 0));
		p_iter = __protocol_table.find(_proto);
	}

	(p_iter->second)++;
}

void Device::add_vulnerability(const Vulnerability &_vul) {
	__vul_list.push_back(_vul);
	__vul_list.unique();
}

void Device::print_proto() {
    std::map<const ndpi_protocol, size_t>::iterator iter;
    
    for (iter = __protocol_table.begin(); iter != __protocol_table.end(); iter++) {
        std::cout << iter->first.master_protocol << " : " << iter->second << std::endl;
    }
    
    std::cout << std::endl;
}


const std::string& Device::get_os() const {
	return __os;
}

const std::map<const ndpi_protocol, size_t>& Device::get_proto_table() const {
    return __protocol_table;
}

const std::list<Vulnerability>& Device::get_vul_list() const {
	return __vul_list;
}
